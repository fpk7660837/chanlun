# 缠论自动指标 (Chanlun Auto Indicator)

TradingView Pine Script v6 缠论指标，支持自动画笔、笔中枢、线段和线段中枢。

## 功能特性

### 1. 自动画笔
- **老笔算法**：顶底分型之间至少有1根独立K线
- **新笔/严格笔算法**：顶底分型的K线区间不允许重叠
- 自动处理K线包含关系
- 自动识别顶底分型
- 动态更新笔的端点

### 2. 笔中枢
- 自动识别至少3笔重叠区域形成的中枢
- 用蓝色半透明矩形框显示
- 支持中枢延伸（当新笔与现有中枢有重叠时）
- 可通过参数开关控制显示

### 3. 线段
- 基于笔的顶底分型自动识别线段
- 用虚线连接线段的起止点
- 线段标签显示"段顶"和"段底"
- 自动处理线段的更新和替换
- 可通过参数开关控制显示

### 4. 线段中枢
- 自动识别线段之间重叠区域形成的中枢
- 用橙色半透明矩形框显示
- 支持线段中枢的延伸
- 可通过参数开关控制显示

## 使用方法

1. 在 TradingView 上打开图表
2. 点击"指标"按钮
3. 选择"Pine Editor"
4. 复制 `chanlun.pine` 内容到编辑器
5. 点击"添加到图表"

## 参数设置

- **画笔算法**：选择"老笔"或"新笔/严格笔"算法
- **显示笔中枢**：开启/关闭笔中枢显示
- **显示线段**：开启/关闭线段显示
- **显示线段中枢**：开启/关闭线段中枢显示

## 颜色说明

- 红色：顶分型、向上的笔/线段
- 绿色：底分型、向下的笔/线段
- 蓝色框：笔中枢
- 橙色框：线段中枢

## 技术实现

- 使用自定义类型（Kx, Fx, Pen, PenCenter, SegFx, SegCenter）
- 维护多个数组来管理K线、分型、笔、线段等数据
- 实时计算区间重叠来识别中枢
- 优化了对象数量限制（最多500个lines、labels、boxes）

## 注意事项

- 脚本在每根K线更新时实时计算
- 历史数据会被完整处理
- 由于TradingView限制，过多历史数据可能导致部分早期对象不显示
- 建议在合适的时间周期使用（如4小时、日线等）
